# AmeriLend Vercel + Railway Deployment Guide

Complete step-by-step guide to deploy AmeriLend with Vercel (frontend) + Railway (backend).

---

## ðŸ“Š Architecture Overview

```
amerilendloan.com (Wix Domain)
        â†“
   â”Œâ”€â”€â”€â”€â”´â”€â”€â”€â”€â”
   â†“         â†“
Vercel   Railway
React    Express
Vite     tRPC
   â†“         â†“
   â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜
        â†“
   PostgreSQL
   (Railway)
```

---

## â±ï¸ Timeline: ~1 hour total setup

- Vercel setup: 15 minutes
- Railway setup: 20 minutes
- Environment configuration: 15 minutes
- DNS setup: 10 minutes
- Testing: 10 minutes

---

## ðŸš€ Phase 1: Vercel Setup (Frontend)

### Step 1.1: Create Vercel Account

1. Go to https://vercel.com
2. Click "Sign up"
3. Choose "Continue with GitHub"
4. Authorize Vercel to access your GitHub repositories

### Step 1.2: Import Repository

1. In Vercel Dashboard, click "Add New..." â†’ "Project"
2. Click "Import Git Repository"
3. Select: `Dianasmith6525/amerilend2`
4. Click "Import"

### Step 1.3: Configure Build Settings

**Root Directory:**
- Leave empty (Vercel auto-detects)
- Or manually set: `.` (project root)

**Framework Preset:**
- Vercel should auto-detect: React
- If not, select from dropdown

**Build Command:**
- Default: `pnpm build`
- This builds both client and server

**Output Directory:**
- Default: `dist`

**Install Command:**
- Default: `pnpm install`

### Step 1.4: Add Environment Variables

Click "Environment Variables" and add:

```
VITE_API_URL = https://api.amerilendloan.com
VITE_APP_ID = (get from your OAuth provider)
```

Make sure both are set to:
- âœ… Production
- âœ… Preview
- âœ… Development

### Step 1.5: Deploy

Click "Deploy" button. Vercel will:
1. Clone your repository
2. Install dependencies
3. Run `pnpm build`
4. Deploy to a preview URL

â³ Wait 3-5 minutes for deployment to complete.

You'll get a URL like: `amerilend2.vercel.app`

### Step 1.6: Add Custom Domain

1. In Vercel Dashboard â†’ Project Settings â†’ Domains
2. Click "Add Domain"
3. Enter: `amerilendloan.com`
4. Also add: `www.amerilendloan.com`

Vercel will provide DNS records like:
```
Type: A
Name: @
Value: 76.76.19.165

Type: CNAME
Name: www
Value: cname.vercel-dns.com
```

**Note:** Save these DNS records for later (Step 4)

---

## ðŸš€ Phase 2: Railway Setup (Backend + Database)

### Step 2.1: Create Railway Account

1. Go to https://railway.app
2. Click "Login"
3. Choose "Continue with GitHub"
4. Authorize Railway

### Step 2.2: Create New Project

1. Click "New Project"
2. Select "Deploy from GitHub repo"
3. Find and select: `Dianasmith6525/amerilend2`
4. Select "Monorepo" if asked

### Step 2.3: Add PostgreSQL Service

1. In the project, click "Add Service"
2. Select "Database" â†’ "PostgreSQL"
3. Railway automatically creates a PostgreSQL instance

### Step 2.4: Configure Backend Service

1. Click "Add Service" â†’ "GitHub Repo"
2. Select your `amerilend2` repo
3. Railway might auto-detect it's a Node.js project

**Settings to configure:**

- **Root Directory**: Leave blank or set to `/` (monorepo)
- **Start Command**: `node dist/index.js`
- **Build Command**: `pnpm install && pnpm build`

### Step 2.5: Configure Environment Variables

Click on the backend service â†’ "Variables"

Add these environment variables:

```
NODE_ENV=production
VITE_CLIENT_URL=https://amerilendloan.com
VITE_API_URL=https://api.amerilendloan.com
SENDGRID_FROM_EMAIL=noreply@amerilendloan.com
LOG_LEVEL=info
```

**Add these as Secrets:**
1. Click "Raw Editor" or "Add Variable"
2. Set as secret (lock icon):

```
JWT_SECRET=(generate with: openssl rand -base64 32)
DATABASE_URL=(auto-generated by PostgreSQL service)
SENDGRID_API_KEY=(from SendGrid)
OAUTH_SERVER_URL=(from your OAuth provider)
VITE_APP_ID=(from OAuth provider)
AUTHORIZE_NET_API_KEY=(if using Authorize.Net)
AUTHORIZE_NET_TRANSACTION_KEY=(if using Authorize.Net)
STRIPE_SECRET_KEY=(if using Stripe)
STRIPE_PUBLISHABLE_KEY=(if using Stripe)
```

### Step 2.6: Link PostgreSQL Service

Railway should auto-link the PostgreSQL service. Verify:

1. In PostgreSQL service â†’ "Connect"
2. Copy the connection string shown
3. This should automatically be available as `DATABASE_URL` to your backend

### Step 2.7: Deploy

1. Click "Deploy" button on the backend service
2. Railway will start building

â³ Wait 5-10 minutes for deployment.

### Step 2.8: Add Custom Domain for API

1. Click the backend service
2. Go to "Domains"
3. Click "Add Domain"
4. Enter: `api.amerilendloan.com`

Railway provides a CNAME record like:
```
Type: CNAME
Name: api
Value: xxx.railway.app
```

Save this for Step 4.

### Step 2.9: Run Database Migrations

If this is first deployment:

1. In Railway, click "Services" in sidebar
2. Select your backend service
3. Click "Shell" tab
4. Run: `pnpm run db:push`
5. This applies all Drizzle migrations

### Step 2.10: Verify Backend is Running

1. Go to your Railway project
2. Open the backend service
3. Click "Logs" tab
4. Look for messages like:
   ```
   Server running on port 3000
   Database connected
   ```

---

## ðŸš€ Phase 3: Environment Configuration

### Step 3.1: Verify All Environment Variables

**In Vercel (Frontend):**
- âœ… VITE_API_URL = https://api.amerilendloan.com
- âœ… VITE_APP_ID = your_app_id

**In Railway (Backend):**
- âœ… DATABASE_URL (auto-set by PostgreSQL)
- âœ… JWT_SECRET
- âœ… NODE_ENV = production
- âœ… SENDGRID_API_KEY
- âœ… OAUTH_SERVER_URL
- âœ… VITE_APP_ID

### Step 3.2: Redeploy if Variables Changed

**In Vercel:**
1. Go to Project â†’ Settings
2. Make sure environment variables are saved
3. Go to Deployments
4. Click "Redeploy" on latest deployment

**In Railway:**
1. Variable changes auto-trigger redeploy
2. Check the backend service logs to confirm

---

## ðŸš€ Phase 4: Wix Domain Configuration

### Step 4.1: Access Wix Domain Settings

1. Log in to Wix.com
2. Go to your account
3. Click Settings (gear icon)
4. Select "Domains"
5. Click on `amerilendloan.com`
6. Select "Manage DNS" or "Advanced"

### Step 4.2: Add Vercel DNS Records

From Vercel (Step 1.6), you got records like:

**Add these to Wix DNS:**

1. **A Record (for root domain)**
   - Type: A
   - Name: @ (or blank)
   - Value: 76.76.19.165 (from Vercel)
   - TTL: 3600

2. **CNAME Record (for www subdomain)**
   - Type: CNAME
   - Name: www
   - Value: cname.vercel-dns.com (from Vercel)
   - TTL: 3600

### Step 4.3: Add Railway API CNAME Record

From Railway (Step 2.8):

**Add this to Wix DNS:**

- Type: CNAME
- Name: api
- Value: xxx.railway.app (from Railway)
- TTL: 3600

### Step 4.4: (Optional) Add Email DNS Records

If you want emails from @amerilendloan.com:

**For SendGrid:**
1. Go to SendGrid â†’ Settings â†’ Sender Authentication
2. Click "Authenticate Your Domain"
3. Enter: amerilendloan.com
4. SendGrid gives you CNAME records
5. Add those CNAME records to Wix DNS

### Step 4.5: Verify DNS Propagation

```bash
# Check DNS propagation
nslookup amerilendloan.com
nslookup api.amerilendloan.com
nslookup www.amerilendloan.com

# Or use online tool:
# https://dnschecker.org
```

â³ DNS propagation takes 5 minutes to 48 hours (usually 1-2 hours)

---

## âœ… Phase 5: Testing & Verification

### Step 5.1: Test Frontend Access

1. Open browser: https://amerilendloan.com
2. Verify page loads (not "Not Found")
3. Check console for errors (F12 â†’ Console tab)
4. Should NOT see CORS errors
5. Should NOT see "Cannot reach API" errors

### Step 5.2: Test API Connection

1. In browser console (F12):
   ```javascript
   fetch('https://api.amerilendloan.com/api/trpc/health.query')
     .then(r => r.json())
     .then(d => console.log(d))
   ```
2. Should see a response (not 404 or 500)

### Step 5.3: Test Email

1. Go to sign-up page
2. Create a test account with a real email
3. Check email inbox for verification email
4. Verify email is from `noreply@amerilendloan.com`
5. Verify it's not in spam folder

### Step 5.4: Test OAuth Login

1. On login page, click "Sign in with [Google/Microsoft/etc]"
2. Should redirect to OAuth provider
3. After login, should redirect back to dashboard
4. Should show "Logged in" state

### Step 5.5: Check SSL Certificate

1. Visit https://amerilendloan.com
2. Click padlock icon ðŸ”’ in browser address bar
3. Should show "Certificate is valid"
4. Should NOT show SSL warnings

### Step 5.6: Monitor Deployment Logs

**Vercel Logs:**
1. Vercel Dashboard â†’ Project â†’ Deployments
2. Click latest deployment
3. Check "Logs" tab for build/runtime errors

**Railway Logs:**
1. Railway Dashboard â†’ Backend Service
2. Click "Logs" tab
3. Look for errors or warnings

---

## ðŸ”§ Troubleshooting

### Issue: 404 on amerilendloan.com

**Cause:** DNS not propagated or Vercel domain not verified

**Solution:**
1. Wait 24 hours for DNS propagation
2. In Vercel â†’ Project â†’ Domains â†’ Check domain status
3. May need to update Wix DNS records again

### Issue: "Cannot reach API" error in browser

**Cause:** API domain not working or CORS misconfigured

**Solution:**
1. Check if `api.amerilendloan.com` loads (should get JSON response or 404, not "connection refused")
2. Verify Railway backend is running (check logs)
3. Add frontend URL to CORS in backend:
   ```typescript
   // server/_core/index.ts
   app.use(cors({
     origin: ['https://amerilendloan.com', 'https://www.amerilendloan.com'],
     credentials: true
   }))
   ```
4. Redeploy to Railway

### Issue: "Database connection failed"

**Cause:** DATABASE_URL not set or PostgreSQL not running

**Solution:**
1. In Railway â†’ PostgreSQL service, check status (should be "running")
2. Click "Connect" to verify connection string
3. Copy connection string to Railway backend as `DATABASE_URL`
4. In backend shell, run: `psql $DATABASE_URL -c "SELECT 1"`
5. Should return `1` if connected

### Issue: Emails not sending

**Cause:** SendGrid API key invalid or from email not verified

**Solution:**
1. Verify SENDGRID_API_KEY in Railway
2. In SendGrid â†’ Settings â†’ Sender Authentication â†’ check if `noreply@amerilendloan.com` is verified
3. Check SendGrid â†’ Activity for bounce/delivery issues
4. Verify email is actually being sent (check logs)

### Issue: OAuth redirects to wrong URL

**Cause:** Redirect URI not registered with OAuth provider

**Solution:**
1. Go to your OAuth provider's dashboard
2. Add redirect URI: `https://amerilendloan.com/api/auth/callback`
3. Add origin: `https://amerilendloan.com`
4. Redeploy backend

---

## ðŸ“ˆ Post-Deployment

### Monitoring

1. **Vercel Analytics**: Vercel â†’ Project â†’ Analytics
   - Monitor traffic, response times
   - Set up alerts for errors

2. **Railway Monitoring**: Railway â†’ Project â†’ Services
   - Monitor memory/CPU usage
   - Check deployment history

### Scaling

1. **If frontend is slow**: Upgrade Vercel plan (paid plans have more resources)
2. **If backend is slow**: 
   - Upgrade Railway plan
   - Upgrade database plan (more storage/RAM)
   - Optimize database queries

### Backups

1. **Database backups**: Railway handles daily backups automatically
2. **Code backups**: GitHub is your backup
3. **Manual backups**: Export from Railway PostgreSQL regularly

---

## ðŸ“š Useful Links

- Vercel Docs: https://vercel.com/docs
- Railway Docs: https://railway.app/docs
- Vercel GitHub Integration: https://vercel.com/docs/git/github
- Railway GitHub Integration: https://railway.app/docs/deploy/github
- SendGrid Setup: https://sendgrid.com/docs/for-developers/sending-email/quickstart-nodejs/
- PostgreSQL Documentation: https://www.postgresql.org/docs/

---

## âœ¨ Congratulations!

Your AmeriLend application is now deployed! ðŸŽ‰

- Frontend: https://amerilendloan.com
- Backend API: https://api.amerilendloan.com
- Admin Dashboard: https://amerilendloan.com/admin
- User Dashboard: https://amerilendloan.com/dashboard

Next steps:
1. Share the link with users
2. Monitor for issues (check logs regularly)
3. Set up SSL certificate monitoring
4. Plan for scaling as traffic grows

---

