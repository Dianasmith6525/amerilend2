# Referral Program - Visual Summary

## ğŸ¯ What Users See

### On Dashboard - New "Referrals" Tab
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Dashboard  [Applications] [Referrals] â”‚ â† NEW
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€ Your Referral Code â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚ â”‚ REF123ABC456        [COPY]          â”‚  â”‚ â† Your Code
â”‚ â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”‚
â”‚ â”‚ https://amerilend.com/signup?ref... â”‚  â”‚
â”‚ â”‚                         [COPY LINK] â”‚  â”‚ â† Share Link
â”‚ â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”‚
â”‚ â”‚ [Share via Email] [Share on Social] â”‚  â”‚ â† Share Buttons
â”‚ â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”‚
â”‚ â”‚ YOU EARN: $50 | THEY SAVE: $25      â”‚  â”‚ â† Rewards
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€ Your Statistics â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚Total   â”‚ â”‚  Total   â”‚ â”‚   Pending   â”‚ â”‚
â”‚ â”‚Referr. â”‚ â”‚ Earnings â”‚ â”‚   Rewards   â”‚ â”‚
â”‚ â”‚   12   â”‚ â”‚  $600    â”‚ â”‚    $200     â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€ Your Referrals (List) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Status | Date | Your Reward | Status    â”‚
â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
â”‚ âœ“Approved | Oct 15 | $50 | PAID        â”‚
â”‚ â†’Applied  | Oct 20 | $50 | EARNED      â”‚
â”‚ âˆ˜ Signup  | Oct 22 | $50 | PENDING     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€ How It Works â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ â‘  Share Your Code                       â”‚
â”‚ â‘¡ They Sign Up                          â”‚
â”‚ â‘¢ They Apply for Loan                   â”‚
â”‚ â‘£ You Earn $50 (They Save $25)         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“Š System Architecture

### Frontend â†’ Backend â†’ Database

```
USER DASHBOARD
    â†“
[Referrals Tab]
    â†“
ReferralComponent.tsx
    â†“
tRPC Routes
    â”œâ†’ referrals.getMyCode
    â”œâ†’ referrals.getStats
    â”œâ†’ referrals.getMyReferrals
    â”œâ†’ referrals.validateCode
    â””â†’ referrals.recordReferral
    â†“
server/db.ts Functions
    â”œâ†’ createReferralCode()
    â”œâ†’ getUserReferralCode()
    â”œâ†’ getReferralCodeByCode()
    â”œâ†’ recordReferral()
    â”œâ†’ getUserReferrals()
    â”œâ†’ getReferralStats()
    â””â†’ updateReferralStatus()
    â†“
DATABASE
    â”œâ†’ referralCodes Table
    â””â†’ referrals Table
```

---

## ğŸ’¾ Data Flow

### When User Logs In First Time
```
User Logs In
    â†“
Dashboard loads
    â†“
referrals.getMyCode called
    â†“
No code exists?
    â†“
System auto-generates code
    â†“
REF123ABC456 displayed
    â†“
User can share immediately
```

### When Someone Signs Up With Code
```
Friend visits: /signup?referral=REF123ABC456
    â†“
validationCode endpoint validates code
    â†“
Friend creates account (User B created)
    â†“
recordReferral endpoint called
    â†“
Database records:
    - referralCodeId: 1
    - referrerId: User A
    - refereeId: User B
    - status: signed_up
    - rewards: pending
    â†“
$25 discount applied to User B
    â†“
User A sees User B in referrals list
```

### When Referrer's Reward Is Earned
```
User B (referee) applies for loan
    â†“
updateReferralStatus called
    â†“
Referral status â†’ "loan_applied"
    â†“
User B's loan gets approved by admin
    â†“
updateReferralStatus called
    â†“
Referral status â†’ "loan_approved"
    â†“
markReferralRewardsEarned called
    â†“
Database updates:
    - referrerRewardStatus: "earned"
    - refereeRewardStatus: "earned"
    - status: "completed"
    â†“
User A dashboard shows:
    - Reward Status: "earned"
    - Can be paid out
```

---

## ğŸ”„ Referral Lifecycle

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   REFERRAL LIFECYCLE                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

STEP 1: CODE GENERATION
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ User A Logs In       â”‚
â”‚ Referral Code Gen    â”‚
â”‚ REF123ABC456 Created â”‚
â”‚ Status: active       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â†“
STEP 2: CODE SHARING
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ User A Shares Code   â”‚
â”‚ Via:                 â”‚
â”‚ - Email              â”‚
â”‚ - Link               â”‚
â”‚ - Social             â”‚
â”‚ - Copy/Paste         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â†“
STEP 3: SIGNUP
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Friend signs up      â”‚
â”‚ Uses code: REF...    â”‚
â”‚ Account created      â”‚
â”‚ Referral recorded    â”‚
â”‚ Status: signed_up    â”‚
â”‚ Reward: pending      â”‚
â”‚ $25 discount applied â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â†“
STEP 4: LOAN APPLICATION
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ User B applies       â”‚
â”‚ for loan             â”‚
â”‚ Status: loan_applied â”‚
â”‚ $25 discount shows   â”‚
â”‚ in fee calculation   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â†“
STEP 5: ADMIN REVIEW
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Admin reviews        â”‚
â”‚ Admin approves       â”‚
â”‚ Status: approved     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â†“
STEP 6: REWARDS EARNED
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Referrer Reward:     â”‚
â”‚ Status: earned       â”‚
â”‚ Amount: $50          â”‚
â”‚ Ready to pay         â”‚
â”‚                      â”‚
â”‚ Referee Reward:      â”‚
â”‚ Status: earned       â”‚
â”‚ Discount: $25        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â†“
STEP 7: PAYOUT
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Referrer: $50 PAID   â”‚
â”‚ Referee: $25 Applied â”‚
â”‚ Status: completed    â”‚
â”‚ Visible in both      â”‚
â”‚ dashboards           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“± UI Components

### ReferralComponent Features

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           REFERRAL COMPONENT STRUCTURE                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

1. CODE DISPLAY SECTION
   â”œâ”€ Your Code: REF123ABC456
   â”‚  â””â”€ [Copy] Button
   â”œâ”€ Shareable Link
   â”‚  â””â”€ [Copy] Button
   â””â”€ Reward Info ($50 / $25)

2. SHARE BUTTONS
   â”œâ”€ [Share via Email]
   â””â”€ [Share on Social]

3. STATISTICS CARDS
   â”œâ”€ Total Referrals: 12
   â”œâ”€ Total Earnings: $600
   â””â”€ Pending Rewards: $200

4. REFERRALS TABLE
   â”œâ”€ Status (signed_up, loan_applied, approved, completed)
   â”œâ”€ Date
   â”œâ”€ Your Reward Amount
   â””â”€ Reward Status (pending, earned, paid)

5. HOW IT WORKS
   â”œâ”€ 4-step visual guide
   â””â”€ Color-coded numbers (1, 2, 3, 4)
```

---

## ğŸ—„ï¸ Database Structure

### referralCodes Table
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              REFERRAL_CODES                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ id (PK)           â”‚ 1                        â”‚
â”‚ userId (FK)       â”‚ 123                      â”‚
â”‚ code (UNIQUE)     â”‚ REF123ABC456             â”‚
â”‚ referrer_reward   â”‚ cash_bonus               â”‚
â”‚ referrer_amount   â”‚ 5000 (cents = $50)       â”‚
â”‚ referee_reward    â”‚ discount                 â”‚
â”‚ referee_amount    â”‚ 2500 (cents = $25)       â”‚
â”‚ status            â”‚ active                   â”‚
â”‚ total_referrals   â”‚ 12                       â”‚
â”‚ total_earnings    â”‚ 60000 (cents = $600)     â”‚
â”‚ created_at        â”‚ 2025-01-15               â”‚
â”‚ updated_at        â”‚ 2025-01-20               â”‚
â”‚ deactivated_at    â”‚ NULL                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### referrals Table
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                 REFERRALS                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ id (PK)               â”‚ 1001                 â”‚
â”‚ referral_code_id (FK) â”‚ 1                    â”‚
â”‚ referrer_id (FK)      â”‚ 123 (User A)         â”‚
â”‚ referee_id (FK)       â”‚ 456 (User B)         â”‚
â”‚ referral_source       â”‚ email                â”‚
â”‚ ip_address            â”‚ 192.168.1.1          â”‚
â”‚ status                â”‚ loan_approved        â”‚
â”‚ referrer_reward_st    â”‚ earned               â”‚
â”‚ referrer_reward_amt   â”‚ 5000 ($50)           â”‚
â”‚ referrer_reward_paid  â”‚ 2025-01-25           â”‚
â”‚ referee_reward_st     â”‚ earned               â”‚
â”‚ referee_reward_amt    â”‚ 2500 ($25)           â”‚
â”‚ referee_reward_apply  â”‚ 2025-01-25           â”‚
â”‚ created_at            â”‚ 2025-01-15           â”‚
â”‚ updated_at            â”‚ 2025-01-25           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ”Œ API Endpoints (tRPC)

### Public Endpoints
```
GET  /api/trpc/referrals.validateCode
     Input: { code: "REF123ABC456" }
     Returns: { valid: boolean, rewards: {...} }

POST /api/trpc/referrals.recordReferral
     Input: { code, refereeUserId, ipAddress }
     Returns: { success: true, referralId: 1 }
```

### Protected Endpoints (Auth Required)
```
GET  /api/trpc/referrals.getMyCode
     Returns: { code, rewards, referralCodeId }

GET  /api/trpc/referrals.getStats
     Returns: { totalReferrals, totalEarnings, pending }

GET  /api/trpc/referrals.getMyReferrals
     Returns: [{ id, status, amount, date }, ...]
```

### Admin Endpoints
```
GET  /api/trpc/referrals.adminList
     Returns: All referrals in system
```

---

## ğŸ“ˆ Reward States

### For Referrer (Person Sharing)
```
Reward States:
  pending   â†’ Waiting for referee to complete application
  earned    â†’ Referee's loan approved, reward confirmed
  paid      â†’ Reward paid to referrer's account
  cancelled â†’ Referral cancelled or disputed
```

### For Referee (Person Referred)
```
Reward States:
  pending   â†’ Waiting for completion
  earned    â†’ Loan approved, reward confirmed
  applied   â†’ Discount applied to account
  cancelled â†’ Referral cancelled or disputed
```

### Overall Referral Status
```
Progression:
  pending          â†’ Just recorded
  signed_up        â†’ Referee created account
  loan_applied     â†’ Referee applied for loan
  loan_approved    â†’ Loan approved by admin
  completed        â†’ Rewards distributed
```

---

## ğŸ”’ Security Flow

```
VALIDATION LAYER
     â†“
Check code exists â†’ Check code active â†’ Check not self-referral
     â†“
RECORDING LAYER
     â†“
Record IP â†’ Track source â†’ Create relationship â†’ Set rewards
     â†“
VERIFICATION LAYER
     â†“
Only pay when loan approved â†’ Validate amounts â†’ Admin can suspend
     â†“
PAYMENT LAYER
     â†“
Mark as earned â†’ Process payout â†’ Confirm completion
```

---

## ğŸš€ Deployment Flow

```
1. DEVELOPMENT
   â”œâ”€ Write code
   â”œâ”€ Test locally
   â””â”€ Review changes

2. DATABASE
   â”œâ”€ Run migration: pnpm run db:push
   â””â”€ Verify tables created

3. TESTING
   â”œâ”€ Test code generation
   â”œâ”€ Test signup with code
   â”œâ”€ Test referral tracking
   â””â”€ Test reward calculations

4. STAGING
   â”œâ”€ Deploy to staging
   â”œâ”€ End-to-end testing
   â””â”€ Monitor logs

5. PRODUCTION
   â”œâ”€ Deploy to production
   â”œâ”€ Monitor performance
   â””â”€ Track adoption
```

---

## ğŸ“Š Expected Outcomes

### Day 1
- âœ… Users can generate codes
- âœ… Users can share codes
- âœ… Referral tracking works

### Week 1
- âœ… First referrals come in
- âœ… Users applying with codes
- âœ… Tracking working smoothly

### Month 1
- âœ… 100+ referrals
- âœ… $$ in referral rewards
- âœ… Viral growth starting

### Month 3+
- âœ… Hundreds of referrals
- âœ… Significant acquisition boost
- âœ… Network effect growing

---

## âœ… Implementation Status

| Component | Status | Files |
|-----------|--------|-------|
| Database Schema | âœ… Complete | drizzle/schema.ts |
| Database Migration | âœ… Complete | drizzle/0008_*.sql |
| Backend Functions | âœ… Complete | server/db.ts (10+ functions) |
| tRPC Routes | âœ… Complete | server/routers.ts (5 routes) |
| Frontend UI | âœ… Complete | ReferralComponent.tsx |
| Dashboard Integration | âœ… Complete | Dashboard.tsx (Referrals tab) |
| Documentation | âœ… Complete | 3 comprehensive guides |

---

**Status**: ğŸŸ¢ READY FOR PRODUCTION

**All systems implemented and tested**
